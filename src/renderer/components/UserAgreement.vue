<template>
  <div class="agreement-overlay">
    <div class="agreement-modal">
      <div class="agreement-header">
        <div class="agreement-icon">ğŸ“œ</div>
        <h2>ç”¨æˆ·ä½¿ç”¨åè®®</h2>
        <p class="agreement-subtitle">è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹æ¡æ¬¾</p>
      </div>
      
      <div class="agreement-content">
        <div class="agreement-section">
          <h3>ğŸ”’ éšç§ä¸å®‰å…¨</h3>
          <ul>
            <li>æœ¬åº”ç”¨é€šè¿‡ P2P æŠ€æœ¯è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œæ‚¨çš„ IP åœ°å€å°†ä¼šæš´éœ²ç»™è¿æ¥çš„èŠ‚ç‚¹</li>
            <li>è¯·ç¡®ä¿æ‚¨æœ‰æƒåˆ†äº«ä¸‹è½½çš„æ–‡ä»¶ï¼Œéµå®ˆç›¸å…³æ³•å¾‹æ³•è§„</li>
            <li>ä¸è¦åˆ†äº«åŒ…å«ä¸ªäººéšç§ã€å•†ä¸šæœºå¯†æˆ–æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶</li>
          </ul>
        </div>
        
        <div class="agreement-section">
          <h3>ğŸ’» èµ„æºä½¿ç”¨è¯´æ˜</h3>
          <ul>
            <li><strong>å¸¦å®½èµ„æº</strong>ï¼šä½œä¸º P2P ç½‘ç»œèŠ‚ç‚¹ï¼Œæ‚¨çš„å¸¦å®½å°†è¢«ç”¨äºä¸ºå…¶ä»–ç”¨æˆ·æä¾›æ–‡ä»¶ä¸‹è½½æœåŠ¡</li>
            <li><strong>å­˜å‚¨ç©ºé—´</strong>ï¼šåº”ç”¨ä¼šç¼“å­˜ä¸‹è½½çš„æ–‡ä»¶å’Œæ–‡ä»¶ç´¢å¼•ä¿¡æ¯</li>
            <li><strong>CPU ä½¿ç”¨</strong>ï¼šæ–‡ä»¶å“ˆå¸Œè®¡ç®—å’Œæ•°æ®åŠ å¯†ä¼šå ç”¨ä¸€å®šçš„ CPU èµ„æº</li>
          </ul>
        </div>
        
        <div class="agreement-section">
          <h3>âš¡ æ³¨æ„äº‹é¡¹</h3>
          <ul>
            <li>å…±äº«ç›®å½•ä¸­çš„æ–‡ä»¶ä¿¡æ¯ï¼ˆå“ˆå¸Œå€¼ã€æ–‡ä»¶åã€å¤§å°ï¼‰ä¼šè¢«ä¸Šä¼ åˆ°ä¿¡ä»¤æœåŠ¡å™¨ä¾›å…¶ä»–ç”¨æˆ·æœç´¢</li>
            <li>ä¸‹è½½æ–‡ä»¶æ—¶ä¼šä»å¤šä¸ªèŠ‚ç‚¹å¹¶è¡Œä¸‹è½½ï¼Œå»ºè®®ä½¿ç”¨ç¨³å®šç½‘ç»œ</li>
            <li>å¤§æ–‡ä»¶ä¸‹è½½å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·ä¿æŒåº”ç”¨è¿è¡Œ</li>
          </ul>
        </div>
        
        <div class="agreement-section">
          <h3>âš ï¸ è´£ä»»å£°æ˜</h3>
          <ul>
            <li>å¼€å‘è€…ä¸å¯¹é€šè¿‡æœ¬åº”ç”¨ä¼ è¾“çš„æ–‡ä»¶å†…å®¹è´Ÿè´£</li>
            <li>ç”¨æˆ·å¯¹è‡ªå·±åˆ†äº«å’Œä¸‹è½½çš„å†…å®¹æ‰¿æ‹…å…¨éƒ¨è´£ä»»</li>
            <li>ç¦æ­¢ç”¨äºéæ³•ç”¨é€”ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç›—ç‰ˆã€ç—…æ¯’ä¼ æ’­ç­‰</li>
          </ul>
        </div>
      </div>
      
      <div class="agreement-footer">
        <div class="checkbox-container" @click="toggleAgreement">
          <div class="custom-checkbox" :class="{ checked: isAgreed }">
            <span v-if="isAgreed">âœ“</span>
          </div>
          <span class="checkbox-label">æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä»¥ä¸Šæ¡æ¬¾</span>
        </div>
        
        <div class="agreement-buttons">
          <button 
            class="btn btn-primary btn-agree" 
            :class="{ disabled: !isAgreed }"
            :disabled="!isAgreed"
            @click="acceptAgreement">
            åŒæ„å¹¶è¿›å…¥
          </button>
          <button class="btn btn-secondary btn-exit" @click="exitApp">
            ä¸åŒæ„å¹¶é€€å‡º
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

const emit = defineEmits<{
  (e: 'accepted'): void
}>()

const isAgreed = ref(false)

const toggleAgreement = () => {
  isAgreed.value = !isAgreed.value
}

const acceptAgreement = async () => {
  if (!isAgreed.value) return
  
  await window.electronAPI.invoke('config:update', {
    userAgreement: {
      accepted: true,
      acceptedAt: new Date().toISOString()
    }
  })
  
  emit('accepted')
}

const exitApp = async () => {
  try {
    await window.electronAPI.invoke('window:close')
  } catch (error) {
    window.close()
  }
}
</script>

<style scoped>
.agreement-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  backdrop-filter: blur(10px);
}

.agreement-modal {
  width: 90%;
  max-width: 700px;
  max-height: 85vh;
  background: linear-gradient(160deg, #1a1a2e 0%, #16213e 100%);
  border-radius: 20px;
  box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.1);
  animation: modalSlideIn 0.4s ease-out;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(30px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.agreement-header {
  padding: 30px 40px 20px;
  text-align: center;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.agreement-icon {
  font-size: 4rem;
  margin-bottom: 10px;
  animation: iconBounce 1s ease-out;
}

@keyframes iconBounce {
  0% { transform: scale(0); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.agreement-header h2 {
  margin: 0 0 8px;
  font-size: 1.8rem;
  color: #fff;
  font-weight: 700;
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.agreement-subtitle {
  margin: 0;
  color: rgba(255, 255, 255, 0.6);
  font-size: 0.95rem;
}

.agreement-content {
  flex: 1;
  overflow-y: auto;
  padding: 25px 40px;
}

.agreement-content::-webkit-scrollbar {
  width: 8px;
}

.agreement-content::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

.agreement-content::-webkit-scrollbar-thumb {
  background: rgba(99, 102, 241, 0.5);
  border-radius: 4px;
}

.agreement-content::-webkit-scrollbar-thumb:hover {
  background: rgba(99, 102, 241, 0.7);
}

.agreement-section {
  margin-bottom: 25px;
}

.agreement-section:last-child {
  margin-bottom: 0;
}

.agreement-section h3 {
  margin: 0 0 12px;
  font-size: 1.1rem;
  color: #a5b4fc;
  display: flex;
  align-items: center;
  gap: 8px;
}

.agreement-section ul {
  margin: 0;
  padding-left: 20px;
}

.agreement-section li {
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.9rem;
  line-height: 1.7;
  margin-bottom: 8px;
}

.agreement-section li strong {
  color: #fbbf24;
}

.agreement-footer {
  padding: 25px 40px;
  background: rgba(0, 0, 0, 0.2);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.checkbox-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  margin-bottom: 20px;
  cursor: pointer;
  user-select: none;
}

.custom-checkbox {
  width: 24px;
  height: 24px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  background: transparent;
}

.custom-checkbox.checked {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  border-color: transparent;
}

.custom-checkbox span {
  color: #fff;
  font-size: 1rem;
  font-weight: bold;
}

.checkbox-label {
  color: rgba(255, 255, 255, 0.9);
  font-size: 1rem;
}

.agreement-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
}

.btn {
  padding: 14px 35px;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  min-width: 140px;
}

.btn-primary {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: #fff;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}

.btn-primary:hover:not(.disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 25px rgba(99, 102, 241, 0.5);
}

.btn-primary.disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-secondary:hover {
  background: rgba(239, 68, 68, 0.2);
  border-color: rgba(239, 68, 68, 0.5);
  color: #fca5a5;
}
</style>